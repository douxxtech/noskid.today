class NskdLbr{constructor(e={}){this.apiUrl=e.apiUrl||"https://check.noskid.today/",this.debug=e.debug||!1,this.timeout=e.timeout||1e4,this.strictCheck=void 0===e.strictCheck||e.strictCheck,this.onLog=e.onLog||null,this.useLegacyAPI=e.useLegacyAPI||!1,this.loginEndpoint=e.loginEndpoint||"",this.onLoginSuccess=e.onLoginSuccess||null,this.onLoginFail=e.onLoginFail||null,this.certificateData=null,this.verificationKey=null,this.localData=null,this.isValid=!1,this.currentLoginModal=null}nskdLbrLog(e,t="info"){if(this.debug){var i=`[${(new Date).toLocaleTimeString()}] NoSkid:`;switch(t){case"error":console.error(i,e);break;case"warning":console.warn(i,e);break;case"success":console.log(`%c${i} `+e,"color: green");break;default:console.log(i,e)}}this.onLog&&"function"==typeof this.onLog&&this.onLog(e,t)}async showLoginModal(){if("undefined"==typeof window)throw new Error("Login modal is only available in browser environments");if(this.loginEndpoint&&""!==this.loginEndpoint.trim())return new Promise((e,t)=>{this.createLoginModal(e,t)});throw new Error("Login endpoint is not configured")}createLoginModal(i,t){this.currentLoginModal&&this.closeLoginModal();let r=document.createElement("div");r.id="noskid-login-overlay",r.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(139, 69, 19, 0.15);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        backdrop-filter: blur(8px);
        opacity: 0;
        transition: opacity 0.3s ease;
    `;var e=document.createElement("div"),a=(e.id="noskid-login-modal",e.style.cssText=`
        background: linear-gradient(135deg, #fcfaf5 0%, #f0ede0 100%);
        border: 2px solid #8b4513;
        border-radius: 16px;
        padding: 0;
        max-width: 480px;
        width: 95%;
        max-height: 95vh;
        overflow: hidden;
        box-shadow: 
            0 25px 50px -12px rgba(139, 69, 19, 0.25),
            0 0 0 1px rgba(139, 69, 19, 0.1),
            inset 0 1px 0 rgba(252, 250, 245, 0.9);
        transform: translateY(20px) scale(0.95);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
    `,document.createElement("style"));a.textContent=`
        @keyframes noskidModalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes noskidPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes noskidShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }
        
        .noskid-modal-active {
            opacity: 1 !important;
        }
        
        .noskid-modal-active #noskid-login-modal {
            transform: translateY(0) scale(1) !important;
        }
        
        .noskid-header {
            background: linear-gradient(135deg, #f9f7f0 0%, #e8e5d8 100%);
            border-bottom: 1px solid #8b4513;
            padding: 24px;
            text-align: center;
            position: relative;
        }
        
        .noskid-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(139, 69, 19, 0.3), transparent);
        }
        
        .noskid-content {
            padding: 32px;
            overflow-y: auto;
            max-height: calc(95vh - 140px);
        }
        
        .noskid-title {
            margin: 0;
            color: #8b4513;
            font-size: 24px;
            font-family: 'Times New Roman', serif;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .noskid-subtitle {
            margin: 8px 0 0 0;
            color: rgba(139, 69, 19, 0.7);
            font-size: 14px;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        .noskid-icon {
            width: 28px;
            height: 28px;
            background: #8b4513;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fcfaf5;
            font-size: 16px;
            box-shadow: 0 2px 4px rgba(139, 69, 19, 0.2);
        }
        
        .noskid-form-group {
            margin-bottom: 24px;
        }
        
        .noskid-label {
            display: block;
            margin-bottom: 8px;
            color: #8b4513;
            font-size: 14px;
            font-weight: 600;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        .noskid-cert-upload {
            border: 2px dashed rgba(139, 69, 19, 0.3);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            background: linear-gradient(135deg, rgba(252, 250, 245, 0.5), rgba(240, 237, 224, 0.5));
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .noskid-cert-upload:hover {
            border-color: #8b4513;
            background: linear-gradient(135deg, rgba(252, 250, 245, 0.8), rgba(240, 237, 224, 0.8));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.1);
        }
        
        .noskid-cert-upload.dragover {
            border-color: #8b4513;
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.1), rgba(139, 69, 19, 0.05));
            animation: noskidPulse 1s infinite;
        }
        
        .noskid-cert-upload.error {
            border-color: #dc2626;
            animation: noskidShake 0.5s ease-in-out;
        }
        
        .noskid-cert-upload.success {
            border-color: #059669;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(5, 150, 105, 0.05));
        }
        
        .noskid-upload-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            background: rgba(139, 69, 19, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8b4513;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .noskid-cert-upload:hover .noskid-upload-icon {
            background: rgba(139, 69, 19, 0.2);
            transform: scale(1.1);
        }
        
        .noskid-upload-text {
            color: #8b4513;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .noskid-upload-hint {
            color: rgba(139, 69, 19, 0.6);
            font-size: 12px;
            line-height: 1.4;
        }
        
        .noskid-file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .noskid-input {
            width: 100%;
            padding: 16px;
            border: 2px solid rgba(139, 69, 19, 0.2);
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            background: rgba(252, 250, 245, 0.8);
            color: #8b4513;
            font-family: system-ui, -apple-system, sans-serif;
            transition: all 0.3s ease;
        }
        
        .noskid-input:focus {
            outline: none;
            border-color: #8b4513;
            box-shadow: 0 0 0 4px rgba(139, 69, 19, 0.1);
            background: #fcfaf5;
        }
        
        .noskid-input::placeholder {
            color: rgba(139, 69, 19, 0.5);
        }
        
        .noskid-btn {
            background: linear-gradient(135deg, #8b4513 0%, #6d3410 100%);
            color: #fcfaf5;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: system-ui, -apple-system, sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .noskid-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .noskid-btn:hover::before {
            left: 100%;
        }
        
        .noskid-btn:hover {
            background: linear-gradient(135deg, #6d3410 0%, #5a2b0d 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 69, 19, 0.3);
        }
        
        .noskid-btn:active {
            transform: translateY(0);
        }
        
        .noskid-btn:disabled {
            background: rgba(139, 69, 19, 0.3);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .noskid-btn:disabled::before {
            display: none;
        }
        
        .noskid-btn-secondary {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.1) 0%, rgba(139, 69, 19, 0.2) 100%);
            color: #8b4513;
            border: 2px solid rgba(139, 69, 19, 0.3);
            padding: 14px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: system-ui, -apple-system, sans-serif;
            transition: all 0.3s ease;
        }
        
        .noskid-btn-secondary:hover {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.3) 100%);
            border-color: #8b4513;
            transform: translateY(-2px);
        }
        
        .noskid-error {
            color: #dc2626;
            font-size: 14px;
            margin-top: 8px;
            padding: 12px;
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.2);
            border-radius: 8px;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        .noskid-success {
            color: #059669;
            font-size: 14px;
            margin-top: 8px;
            padding: 12px;
            background: rgba(5, 150, 105, 0.1);
            border: 1px solid rgba(5, 150, 105, 0.2);
            border-radius: 8px;
            font-family: system-ui, -apple-system, sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .noskid-actions {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
            margin-top: 32px;
        }
        
        .noskid-cert-info {
            background: rgba(139, 69, 19, 0.05);
            border: 1px solid rgba(139, 69, 19, 0.2);
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .noskid-cert-user {
            font-weight: 600;
            color: #8b4513;
            margin-bottom: 4px;
        }
        
        .noskid-cert-details {
            font-size: 12px;
            color: rgba(139, 69, 19, 0.7);
        }
        
        .noskid-paste-hint {
            margin-top: 8px;
            font-size: 11px;
            color: rgba(139, 69, 19, 0.5);
            text-align: center;
            font-style: italic;
        }
        
        @media (max-width: 600px) {
            .noskid-content {
                padding: 24px;
            }
            
            .noskid-header {
                padding: 20px;
            }
            
            .noskid-title {
                font-size: 20px;
            }
            
            .noskid-actions {
                flex-direction: column-reverse;
            }
            
            .noskid-btn,
            .noskid-btn-secondary {
                width: 100%;
                justify-content: center;
            }
        }
    `,document.head.appendChild(a),e.innerHTML=`
        <div class="noskid-header">
            <h2 class="noskid-title">
                <div class="noskid-icon">🔐</div>
                Login with NoSkid
            </h2>
            <p class="noskid-subtitle">Upload your certificate and enter your password to authenticate</p>
        </div>
        
        <div class="noskid-content">
            <div class="noskid-form-group">
                <label class="noskid-label">Certificate File</label>
                <div class="noskid-cert-upload" id="noskid-cert-upload">
                    <div class="noskid-upload-icon">📄</div>
                    <div class="noskid-upload-text">Drop certificate here or click to browse</div>
                    <div class="noskid-upload-hint">
                        Supports .png files • Drag & drop • Paste from clipboard<br>
                        <kbd>Ctrl+V</kbd> to paste certificate
                    </div>
                    <input type="file" id="noskid-cert-file" accept=".png" class="noskid-file-input">
                </div>
                <div id="noskid-file-error" class="noskid-error" style="display: none;"></div>
                <div id="noskid-file-success" class="noskid-success" style="display: none;">
                    <span>✓</span>
                    <div id="noskid-cert-info"></div>
                </div>
            </div>
            
            <div class="noskid-form-group">
                <label class="noskid-label">Password</label>
                <input type="password" id="noskid-password" class="noskid-input" placeholder="Enter your password">
                <div id="noskid-password-error" class="noskid-error" style="display: none;"></div>
            </div>
            
            <div id="noskid-login-error" class="noskid-error" style="display: none;"></div>
            
            <div class="noskid-actions">
                <button id="noskid-cancel-btn" class="noskid-btn-secondary">Cancel</button>
                <button id="noskid-login-btn" class="noskid-btn" disabled>
                    <span>Login</span>
                </button>
            </div>
        </div>
    `,r.appendChild(e),document.body.appendChild(r),this.currentLoginModal=r,requestAnimationFrame(()=>{r.classList.add("noskid-modal-active")});let o=e.querySelector("#noskid-cert-upload");a=e.querySelector("#noskid-cert-file");let s=e.querySelector("#noskid-password"),n=e.querySelector("#noskid-login-btn");var d=e.querySelector("#noskid-cancel-btn");let l=e.querySelector("#noskid-file-error"),c=e.querySelector("#noskid-file-success"),g=e.querySelector("#noskid-cert-info"),f=e.querySelector("#noskid-password-error"),p=e.querySelector("#noskid-login-error"),u=!1,h=null,b=async e=>{if(l.style.display="none",c.style.display="none",o.classList.remove("error","success"),u=!1,h=null,k(),e){try{this.nskdLbrLog("Processing certificate for login...","info");var t=new NskdLbr({apiUrl:this.apiUrl,debug:this.debug,timeout:this.timeout,strictCheck:this.strictCheck,useLegacyAPI:this.useLegacyAPI}),i=await t.loadFromFile(e);if(!i.valid)throw new Error(i.message||"Certificate verification failed");u=!0,h=t.getCertificateData(),g.innerHTML=`
                    <div class="noskid-cert-user">${h.localUsername||"Unknown User"}</div>
                    <div class="noskid-cert-details">
                        Certificate verified • ${(e.size/1024).toFixed(1)} KB
                    </div>
                `,o.classList.add("success"),o.querySelector(".noskid-upload-text").textContent="Certificate loaded successfully!",o.querySelector(".noskid-upload-icon").textContent="✓",c.style.display="block",this.nskdLbrLog("Certificate verified for login","success")}catch(e){o.classList.add("error"),o.querySelector(".noskid-upload-text").textContent="Certificate verification failed",o.querySelector(".noskid-upload-icon").textContent="❌",l.textContent=e.message,l.style.display="block",this.nskdLbrLog("Certificate verification failed: "+e.message,"error")}k()}},k=(a.addEventListener("change",async e=>{e=e.target.files[0];await b(e)}),o.addEventListener("dragover",e=>{e.preventDefault(),o.classList.add("dragover")}),o.addEventListener("dragleave",e=>{e.preventDefault(),o.contains(e.relatedTarget)||o.classList.remove("dragover")}),o.addEventListener("drop",async e=>{e.preventDefault(),o.classList.remove("dragover");var e=e.dataTransfer.files;0<e.length&&("image/png"===(e=e[0]).type||e.name.endsWith(".png")?await b(e):(o.classList.add("error"),l.textContent="Please drop a valid PNG certificate file",l.style.display="block"))}),document.addEventListener("paste",async e=>{var t;if(r.classList.contains("noskid-modal-active"))for(t of e.clipboardData.items)if("image/png"===t.type){e.preventDefault();var i=t.getAsFile();i&&await b(i);break}}),s.addEventListener("input",()=>{f.style.display="none",p.style.display="none",k()}),()=>{var e=0<s.value.trim().length;n.disabled=!u||!e,n.innerHTML="<span>Login</span>"}),m=(n.addEventListener("click",async()=>{var t=s.value.trim();if(u&&h)if(t){n.disabled=!0,n.innerHTML="<span>Logging in...</span>",p.style.display="none";try{let e=await this.performLogin(h,t);if(!e.success)throw new Error(e.message||"Login failed");this.nskdLbrLog("Login successful","success"),this.certificateData=h,this.verificationKey=h.key,this.isValid=!0,this.onLoginSuccess&&"function"==typeof this.onLoginSuccess&&this.onLoginSuccess(e,h),n.innerHTML="<span>Success!</span>",setTimeout(()=>{this.closeLoginModal(),i({success:!0,data:h,response:e})},800)}catch(e){this.nskdLbrLog("Login failed: "+e.message,"error"),p.textContent=e.message,p.style.display="block",this.onLoginFail&&"function"==typeof this.onLoginFail&&this.onLoginFail(e,h),n.disabled=!1,n.innerHTML="<span>Try Again</span>"}}else f.textContent="Please enter your password",f.style.display="block";else f.textContent="Please upload a valid certificate first",f.style.display="block"}),d.addEventListener("click",()=>{this.nskdLbrLog("Login cancelled by user","info"),this.closeLoginModal(),t(new Error("Login cancelled by user"))}),r.addEventListener("click",e=>{e.target===r&&(this.nskdLbrLog("Login cancelled by clicking outside","info"),this.closeLoginModal(),t(new Error("Login cancelled")))}),e=>{"Escape"===e.key&&(this.nskdLbrLog("Login cancelled by ESC key","info"),this.closeLoginModal(),document.removeEventListener("keydown",m),t(new Error("Login cancelled")))});document.addEventListener("keydown",m),u&&s.focus()}async performLogin(e,t){let i=new AbortController;var r=setTimeout(()=>i.abort(),this.timeout);try{var a=await fetch(this.loginEndpoint,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"NskdLbr/1.1.0"},body:JSON.stringify({certificate:{key:e.key,username:e.localUsername,nickname:e.nickname,certificate_number:e.certificate_number,percentage:e.percentage,country:e.country,countryCode:e.countryCode,creationDate:e.creationDate},password:t}),signal:i.signal});if(clearTimeout(r),a.ok)return await a.json();throw new Error(`HTTP ${a.status}: `+a.statusText)}catch(e){if(clearTimeout(r),"AbortError"===e.name)throw new Error("Login timeout - server took too long to respond");throw new Error("Login API error: "+e.message)}}closeLoginModal(){this.currentLoginModal&&(this.currentLoginModal.remove(),this.currentLoginModal=null)}async loadFromFile(e){try{if(this.nskdLbrLog("Starting certificate verification process...","info"),!e)throw new Error("No file provided");if(!e.name.toLowerCase().endsWith(".png"))throw new Error("File must be a PNG image");this.nskdLbrLog("Processing certificate file: "+e.name,"info");var t=await this.readFileAsArrayBuffer(e),i=await this.extractTextFromPng(t);if(!i)throw new Error("Could not extract verification data from file");if(this.verificationKey=this.extractVerificationKey(i),this.verificationKey)return this.nskdLbrLog("Successfully extracted verification key","success"),this.localData=this.extractLocalData(i),this.localData&&(this.nskdLbrLog("Local certificate data extracted:","info"),this.nskdLbrLog("Username: "+this.localData.username,"info"),this.nskdLbrLog("Creation Date: "+this.localData.creationDate,"info")),await this.verifyWithAPI();throw new Error("No valid verification key found in certificate")}catch(e){throw this.nskdLbrLog("Error loading certificate: "+e.message,"error"),e}}async verifyWithKey(e){try{if(!e||"string"!=typeof e)throw new Error("Invalid verification key provided");if(/^[a-f0-9]{64}$/i.test(e))return this.verificationKey=e.toLowerCase(),this.nskdLbrLog(`Verifying certificate with key: ${this.verificationKey.substring(0,16)}...`,"info"),await this.verifyWithAPI();throw new Error("Verification key must be a 64-character hexadecimal string")}catch(e){throw this.nskdLbrLog("Error verifying certificate: "+e.message,"error"),e}}getCertificateData(){return this.certificateData?{...this.certificateData,key:this.verificationKey,localUsername:this.localData?this.localData.username:null,localCreationDate:this.localData?this.localData.creationDate:null}:null}isValidCertificate(){return this.isValid}getFormattedDetails(){var e,t;return this.certificateData?(e=this.certificateData,t=!this.useLegacyAPI&&e.nickname||e.username,`
Certificate Details:
- Certificate #: ${e.certificate_number}
- Username: ${t}
- Percentage: ${e.percentage}%
- Creation Date: ${e.creationDate}
- Country: ${e.country} (${e.countryCode})
        `.trim()):"No certificate data available"}reset(){this.certificateData=null,this.verificationKey=null,this.localData=null,this.isValid=!1,this.closeLoginModal(),this.nskdLbrLog("Certificate data reset","info")}readFileAsArrayBuffer(r){return new Promise((t,e)=>{var i=new FileReader;i.onload=e=>t(e.target.result),i.onerror=()=>e(new Error("Error reading file")),i.readAsArrayBuffer(r)})}async extractTextFromPng(i){try{var r=new Uint8Array(i);if(137!==r[0]||80!==r[1]||78!==r[2]||71!==r[3])throw new Error("Not a valid PNG file");let e=8,t=null;for(;e<r.length-12;){var a=r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3];if("tEXt"===String.fromCharCode(r[e+4],r[e+5],r[e+6],r[e+7])){var o=r.slice(e+8,e+8+a),s=new TextDecoder("utf-8").decode(o),n=s.indexOf("\0");if(-1!==n){var d=s.substring(0,n),l=s.substring(n+1);if("noskid-key"===d){t=l;break}}}e+=8+a+4}return t?(this.nskdLbrLog("Certificate data extracted successfully from PNG","success"),t):(this.nskdLbrLog("No 'noskid-key' text chunk found in PNG","error"),null)}catch(e){return this.nskdLbrLog("Error extracting text from PNG: "+e.message,"error"),null}}extractVerificationKey(e){try{var t=/-*BEGIN NOSKID KEY-*\s*([a-f0-9]{64})/i,i=e.match(t);return i?i[1].toLowerCase():null}catch(e){return this.nskdLbrLog("Error extracting verification key: "+e.message,"error"),null}}extractLocalData(e){try{var t,i,r,a,o,s=/-----BEGIN NOSKID KEY-----\s*([a-f0-9]+)\s*([A-Za-z0-9+/=]+)\s*([A-Za-z0-9+/=]+)\s*-----END NOSKID KEY-----/,n=e.match(s);return n?(t=n[2],r=(i=atob(t.replace(/=/g,"")).match(/CERT-\d+-(.+)/))?i[1]:null,a=n[3],{username:r,creationDate:(o=atob(a.replace(/=/g,"")).match(/CREATED-(.+)/))?o[1]:null}):null}catch(e){return this.nskdLbrLog("Error extracting local data: "+e.message,"error"),null}}async verifyWithAPI(){try{this.nskdLbrLog("Verifying certificate with server...","info");let e=new AbortController;var t=setTimeout(()=>e.abort(),this.timeout),i=await fetch(this.apiUrl+"?key="+encodeURIComponent(this.verificationKey),{signal:e.signal,headers:{"User-Agent":"NskdLbr/1.1.0"}});if(clearTimeout(t),!i.ok)throw new Error(`HTTP ${i.status}: `+i.statusText);var r=await i.json();if(!r.success)return this.isValid=!1,this.nskdLbrLog("Certificate verification failed: "+r.message,"error"),{valid:!1,message:r.message,cached:r.cached||!1};if(this.localData&&this.strictCheck){var a=!this.useLegacyAPI&&r.data.nickname||r.data.username,o=this.compareData(this.localData,{...r.data,username:a});if(!o.valid)return this.isValid=!1,this.nskdLbrLog("Certificate data mismatch!","error"),this.nskdLbrLog("Mismatch reason: "+o.reason,"error"),this.nskdLbrLog("Note: Strict checking is enabled. Set strictCheck to false to skip local data validation.","warning"),{valid:!1,message:"Data mismatch: "+o.reason,cached:r.cached||!1,strictCheck:!0};this.nskdLbrLog("Local data validation passed","success")}else this.localData&&!this.strictCheck&&this.nskdLbrLog("Strict checking disabled - skipping local data validation","warning");return this.isValid=!0,this.certificateData=r.data,this.nskdLbrLog("Certificate is VALID!","success"),{valid:!0,message:"Certificate verified successfully",data:r.data,cached:r.cached||!1,strictCheck:this.strictCheck}}catch(e){if("AbortError"===e.name)throw new Error("Request timeout - server took too long to respond");throw new Error("API verification failed: "+e.message)}}compareData(e,t){return e&&t?e.username!==t.username?{valid:!1,reason:`Username mismatch: Local=${e.username}, API=`+t.username}:(e=e.creationDate.substring(0,16))!==(t=t.creationDate.substring(0,16))?{valid:!1,reason:`Creation date mismatch: Local=${e}, API=`+t}:{valid:!0}:{valid:!1,reason:"Missing data for comparison"}}}"undefined"!=typeof module&&module.exports?module.exports=NskdLbr:window.NskdLbr=NskdLbr;